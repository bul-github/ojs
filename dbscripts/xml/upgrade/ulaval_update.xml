<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data SYSTEM "../../../lib/pkp/dtd/xmlData.dtd">

<!--
  * dbscripts/xml/upgrade/ulaval_update.xml
  *
  * Copyright (c) 2013-2021 Simon Fraser University
  * Copyright (c) 2003-2021 John Willinsky
  * Copyright (c) 2021 UniversitÃ© Laval
  * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.
  *
  * Update queries for OJS 3.3.0.X
  -->

<data>
	<sql><!-- Gossip value should be contextual, preserve the old ones in existing contexts. -->
		<query>INSERT INTO private_notes (context_id, user_id, note) SELECT DISTINCT ug.context_id, u.user_id, u.gossip FROM ojs_ts.users u JOIN ojs_ts.user_user_groups uug ON uug.user_id = u.user_id JOIN ojs_ts.user_groups ug ON ug.user_group_id = uug.user_group_id WHERE u.gossip IS NOT NULL AND u.gossip != ''</query>
		<query>ALTER TABLE users DROP COLUMN gossip</query>
	</sql>
	<sql><!-- Insert default values for the user statuses. -->
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.student', 1)</query>
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.professor', 2)</query>
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.other', 3)</query>
	</sql>
</data>
