<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data SYSTEM "../../../lib/pkp/dtd/xmlData.dtd">

<!--
  * dbscripts/xml/upgrade/ulaval_update.xml
  *
  * Copyright (c) 2013-2021 Simon Fraser University
  * Copyright (c) 2003-2021 John Willinsky
  * Copyright (c) 2021 Université Laval
  * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.
  *
  * Update queries for OJS 3.3.0.X
  -->

<data>
	<sql><!-- Gossip value should be contextual, preserve the old ones in existing contexts. -->
		<query>INSERT INTO private_notes (context_id, user_id, note) SELECT DISTINCT ug.context_id, u.user_id, u.gossip FROM ojs_ts.users u JOIN ojs_ts.user_user_groups uug ON uug.user_id = u.user_id JOIN ojs_ts.user_groups ug ON ug.user_group_id = uug.user_group_id WHERE u.gossip IS NOT NULL AND u.gossip != ''</query>
		<query>ALTER TABLE users DROP COLUMN gossip</query>
	</sql>
	<sql><!-- Insert default values for the user statuses. -->
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.student', 1)</query>
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.professor', 2)</query>
		<query>INSERT INTO statuses (locale_key, seq) VALUES ('user.status.other', 3)</query>
	</sql>
	<sql><!-- Add default email templates for duplicates detection. -->
		<query>INSERT INTO email_templates_default (email_key, can_disable, can_edit, from_role_id, to_role_id) VALUES ('DUPLICATE_DETECTION_NOTIFICATION', 0, 1, NULL, NULL);</query>
		<query>INSERT INTO email_templates_default_data VALUES ('DUPLICATE_DETECTION_NOTIFICATION', 'fr_CA', 'Avis de détection de doublon potentiel', 'Un doublon potentiel vient d''être détecté. La soumission suivante faite dans la revue "{$contextName1}" {$submissionUrl1} est semblable à la soumission faite dans "{$contextName2}" {$submissionUrl2}<br /><br />Le doublon a été identifié à partir des: {$where}.<br />Ratio de similarité: {$similarityRatio}.<br />', 'Ce courriel est envoyé au contact principal de la revue afin d''aviser qu''un article doublon a été détecté.');</query>
		<query>INSERT INTO email_templates_default_data VALUES ('DUPLICATE_DETECTION_NOTIFICATION', 'en_US', 'Notice of potential duplicate', 'A potential duplicate has been detected. The following submission in "{$contextName1}" {$submissionUrl1} is similar to a submission made in "{$contextName2}" {$submissionUrl2}<br /><br />Duplicate has been identified in: {$where}.<br />Similarity ratio: {$similarityRatio}.<br />', 'This email is sent to the journal main contact as a notice that an article duplicate has been detected.');</query>
	</sql>
</data>
